<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($rootScope, $timeout, cabrillo) {
	var c = this;
	var MESP_POP_UP_CLOSE_EVENT_NAME = 'mesp.popup.close';
	init();

	// Set Title in Mobile
	if (c.data.isMobileApp){
		setMobileTitle();
		//Event from MESP pop up close.
		var mespClosePopupUnregister = $rootScope.$on(MESP_POP_UP_CLOSE_EVENT_NAME, function() {
			setMobileTitle();
		});
	}

	function setMobileTitle(){
		// Timeout is to give a better user experience otherwise when this popup closes/opens as it has transistion effects
		$timeout(function(){
				cabrillo.viewLayout.setTitle(c.data.topic.name);
			});
	}


	function init() {
		$timeout(function() {
			$rootScope.$broadcast('sp.update.breadcrumbs', c.data.breadcrumbs);
		});
	}

	c.getIconColorClass = function() {
		if(c.options.icon_background_color &&
			c.options.icon_background_color.length > 0 &&
				c.options.icon_background_color !== 'custom') {
			return c.options.icon_background_color;
		}
		return '';
	};

	c.getIconBackgroundColor = function() {
		if(c.options.icon_background_color && c.options.icon_background_color.length > 0 && c.options.icon_background_color === 'custom' && c.options.icon_background_hexcode && c.options.icon_background_hexcode.length > 0) {
			return {'background-color' : c.options.icon_background_hexcode};
		}
		return '';
	};

	c.getBannerColorClass = function() {
		if(c.options.banner_background_color &&
			c.options.banner_background_color.length > 0 &&
				c.options.banner_background_color !== 'custom') {
			return c.options.banner_background_color;
		}
		return '';
	};

	c.getTopicHeaderWithBannerClass = function() {
		var topicHeaderClass = 'topic-header-banner';
		if(c.data.isMobileApp) {
			topicHeaderClass = topicHeaderClass.concat(' ','topic-header-banner-mobile');
		}
		topicHeaderClass = topicHeaderClass.concat(' ', c.options.banner_text_overlay_color);
		return topicHeaderClass;
	};

	c.getBannerStyle = function() {
		var bannerStyle = {};
		if(c.options.banner_image_position && c.options.banner_image_position.includes(' ')) {
			var backgroundPosition = c.options.banner_image_position.split(" ");
			bannerStyle['background-position-x'] = backgroundPosition[0];
			bannerStyle['background-position-y'] = backgroundPosition[1];
		}
		bannerStyle['background-size'] = c.options.banner_image_display;
		bannerStyle['background-image'] = 'url('+c.data.topic.banner+')';
		if(c.options.banner_background_color === 'custom' &&
			c.options.banner_background_hexcode &&
				c.options.banner_background_hexcode.length > 0) {
			bannerStyle['background-color'] = c.options.banner_background_hexcode;
		}
		return bannerStyle;
	};

	c.getTransparency = function() {
		return {'opacity' : c.options.banner_text_overlay_transparency};
	};
};]]></client_script>
        <controller_as>c</controller_as>
        <css>$sp-space--xl: 24px !default;
$sp-space--lg: 16px !default;
$sp-space--md: 12px !default;
$sp-space--xxl: 32px !default;
$sp-space--sm: 8px !default;

$font-size-base: 16px !default;
$headings-font-weight: 600 !default;

$brand-primary:#4f52bd !default;
$brand-primary-darker: #333579 !default;
$brand-primary-lightest: #D1D2EE !default;

$background-primary: #ffffff !default;
$background-secondary: #f6f6f8 !default;
$background-tertiary: #F0F1F5 !default;

$color-darkest: #181A1F !default;
$color-lightest: #FFFFFF !default;

$banner-height-mobile: 200px;
$banner-height-desktop: 300px;

.background-primary {
  background-color: $background-primary;
}

.background-secondary {
  background-color: $background-secondary;
}

.background-tertiary {
  background-color: $background-tertiary;
}

.brand-primary {
  background-color: $brand-primary;
}

.brand-primary-darker {
  background-color: $brand-primary-darker;
}

.brand-primary-lightest {
  background-color: $brand-primary-lightest;
}

.topic-header-icon__image-div {
  min-width: 90px;
  height: 90px;
  margin-right: $sp-space--xl;
  display: flex;
  border-radius: 10px;
  justify-content: center;
  align-items: center;
  img {
    width: 56px;
    height: 56px;
  }
}

.topic-header-icon__text {
  word-break: break-word;
  .topic-header-title {
    font-size: ceil(($font-size-base * 2));
    margin: 0;
  }
  .topic-header-description {
    padding-top: $sp-space--sm;
    font-size: $font-size-base;
    margin: 0;
  }
}

.topic-header {
  display: flex;
  align-items: center;
  margin: $sp-space--lg;
}

.topic-header-mobile {
  display: flex;
  align-items: center;
  margin: 20px $sp-space--lg;
  .topic-header-icon__image-div {
    margin-right: $sp-space--lg;
  }
  .topic-header-title {
    font-size: 28px !important;
    font-weight: $headings-font-weight;
    margin: 0;
  }
}

.mobile-border {
  border-bottom: 12px solid #F6F7F7;
}

.topic-header-banner__text {
  position: absolute;
  bottom: 0;
  padding: $sp-space--xl;
  word-break: break-word;
  .topic-header-title {
    margin: 0;
  }
  .topic-header-description {
    padding-top: $sp-space--sm;
    font-size: $font-size-base;
    margin: 0;
  }
}

.topic-header-banner {
  margin: $sp-space--md $sp-space--lg $sp-space--xl $sp-space--lg;
  position: relative;
  .topic-header-banner__image {
    width: 100%;
    border-radius: $border-radius-large;
    height: $banner-height-desktop;
    background-repeat: no-repeat;
    .topic-header-banner__gradient {
      border-radius: 5px;
      height: $banner-height-desktop;
    }
  }
}

.topic-header-banner-mobile {
  padding: 0;
  margin: 0;
  .topic-header-banner__image {
    border-radius: 0;
    height: $banner-height-mobile;
    .topic-header-banner__gradient {
      border-radius: 0;
      height: $banner-height-mobile;
    }
  }
  .topic-header-banner__text {
    padding: $sp-space--lg;
  }
}

.topic-header-gradient-dark {
  .topic-header-banner__gradient {
    background-image: linear-gradient(to right, $color-darkest, transparent);
  }
  text-shadow: 0 0 10px $color-darkest;
  color: $color-lightest;
  .topic-header-title {
    color: $color-lightest !important;
  }
}

.topic-header-gradient-light {
  .topic-header-banner__gradient {
    background-image: linear-gradient(to right, $color-lightest, transparent);
  }
  text-shadow: 0 0 10px $color-lightest;
  color: $color-darkest;
  .topic-header-title {
    color: $color-darkest !important;
  }
}

@media (max-width: 500px) {
  .topic-header-title {
    font-size: 28px !important;
  }
  .topic-header-banner {
    margin: 0;
    padding-top: 0;
    margin-bottom: $sp-space--lg;
    .topic-header-banner__image {
      border-radius: 0;
      height: $banner-height-mobile;
      .topic-header-banner__gradient {
        border-radius: 0;
        height: $banner-height-mobile;
      }
    }
    .topic-header-banner__text {
      bottom: 0;
      padding: $sp-space--lg;
    }
  }
  .topic-header-gradient-dark {
    .topic-header-banner__gradient {
      background-image: linear-gradient(to top, $color-darkest, transparent);
    }
  }
  .topic-header-gradient-light {
    .topic-header-banner__gradient {
      background-image: linear-gradient(to top, $color-lightest, transparent);
    }
  }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>vv_topic_header</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>VV_Topic_Header</name>
        <option_schema>[{"name":"include_description","section":"Presentation","default_value":"false","label":"Include Description","type":"boolean"},{"name":"primary_display","section":"Presentation","default_value":"banner","label":"Primary Display (This will show up for all topics, unless specified below)","type":"choice","choices":[{"label":"Text Only","value":"text_only"},{"label":"Icon","value":"icon"},{"label":"Banner","value":"banner"}]},{"name":"secondary_display","section":"Presentation","default_value":"text_only","label":"Secondary Display (This will show up for the selected topics below)","type":"choice","choices":[{"label":"Text Only","value":"text_only"},{"label":"Icon","value":"icon"},{"label":"Banner","value":"banner"}]},{"displayValue":"Topic","name":"select_topics","display_value_list":[],"section":"Presentation","label":"Select list of topics (For these topics, secondary display will be applied)","type":"glide_list","value":"topic","ed":{"reference":"topic"}},{"name":"banner_background_color","section":"Presentation","default_value":"brand-primary","label":"Banner Background Color","type":"choice","choices":[{"label":"Brand Primary","value":"brand-primary"},{"label":"Brand Primary Darker","value":"brand-primary-darker"},{"label":"Brand Primary Lightest","value":"brand-primary-lightest"},{"label":"Custom, Enter a hex code","value":"custom"}]},{"hint":"Applies when custom banner background color selected.","name":"banner_background_hexcode","section":"Presentation","label":"Banner Background Color Hexcode","type":"string"},{"name":"banner_image_position","section":"Presentation","default_value":"center center","label":"Banner Image Position","type":"choice","choices":[{"label":"Left Top","value":"left top"},{"label":"Left Center","value":"left center"},{"label":"Left Bottom","value":"left bottom"},{"label":"Right Top","value":"right top"},{"label":"Right Center","value":"right center"},{"label":"Right Bottom","value":"right bottom"},{"label":"Center Top","value":"center top"},{"label":"Center Center","value":"center center"},{"label":"Center Bottom","value":"center bottom"}]},{"name":"banner_image_display","section":"Presentation","default_value":"cover","label":"Banner Image Display","type":"choice","choices":[{"label":"Scale to fit","value":"cover"},{"label":"Original size","value":"contain"}]},{"name":"banner_text_overlay_color","section":"Presentation","default_value":"topic-header-gradient-dark","label":"Banner Text Overlay Color","type":"choice","choices":[{"label":"Overlay Dark","value":"topic-header-gradient-dark"},{"label":"Overlay Light","value":"topic-header-gradient-light"}]},{"name":"banner_text_overlay_transparency","section":"Presentation","default_value":"0.5","label":"Banner Text Overlay Opacity (0 is full transparency and 1 is no transparency) ","type":"choice","choices":[{"label":"0","value":"0"},{"label":"0.1","value":"0.1"},{"label":"0.2","value":"0.2"},{"label":"0.3","value":"0.3"},{"label":"0.4","value":"0.4"},{"label":"0.5","value":"0.5"},{"label":"0.6","value":"0.6"},{"label":"0.7","value":"0.7"},{"label":"0.8","value":"0.8"},{"label":"0.9","value":"0.9"},{"label":"1","value":"1"}]},{"name":"icon_background_color","section":"Presentation","default_value":"background-primary","label":"Icon Background Color","type":"choice","choices":[{"label":"Background Primary","value":"background-primary"},{"label":"Background Secondary","value":"background-secondary"},{"label":"Background Tertiary","value":"background-tertiary"},{"label":"Custom, Enter a hex code","value":"custom"}]},{"hint":"Applies when custom icon background color selected.","name":"icon_background_hexcode","section":"Presentation","label":"Icon Background Color Hexcode","type":"string"}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	data.breadcrumbs = [];
	data.displayMode = "text_only";

	var BANNER = "banner";
	var ICON = "icon";
	var TEXT_ONLY = "text_only";
	var topicId = (input && input.topic_id) || options.topic_id || $sp.getParameter("topic_id");
	data.isMobileApp = $sp.getParameter('view') === 'mobile';
	fetchTopicHeaderData();

	if (data.topic && data.topic.parentTopicId) {
		try {
			var breadcrumbs = new sn_ex_sp.TopicPageUtil().fetchBreadCrumbsForTopic(data.topic.parentTopicId);
			breadcrumbs.push(data.breadcrumbs.pop());
			data.breadcrumbs = breadcrumbs;
		} catch (e) {
			gs.error(e.getMessage());
			gs.addErrorMessage(gs.getMessage("Error occurred, please refer logs for information"));
		}
	}

	function fetchTopicHeaderData() {
		var gr = new GlideRecord("topic");
		gr.addActiveQuery();
		gr.addQuery("sys_id", topicId);
		gr.query();
		if (gr.next()) {
			var topicName = gr.getDisplayValue("name");
			data.topic = {
				"id": topicId,
				"name": topicName,
				"desc": gr.getDisplayValue("description"),
				"icon": "",
				"banner": "",
				"parentTopicId": gr.getValue("parent_topic")
			};
			data.breadcrumbs.unshift({
				"label": topicName,
				"url": "#"
			});

			fetchIconOrBanner();
		}
	}


	function fetchIconOrBanner() {
		var TOPIC_CONTENT_EXPERIENCE_SC = '';
		var TOPIC_CONTENT_EXPERIENCE_CC = '';
		var CEW = '26b2b8cfff02201014c6a36cf43bf1a0';
		var widget_ce_schedule_content =[];
		var widget_ce_campaign_content = [];

		if(new GlidePluginManager().isActive('com.sn_content_delivery')){
			var gr = new GlideRecord('sn_cd_content_visibility');
			gr.addQuery('topic','CONTAINS', topicId);
			gr.addActiveQuery();
			gr.query();
			while (gr.next()) {
				if(gr.sp_instance.sp_widget == CEW) {
					TOPIC_CONTENT_EXPERIENCE_SC = gr.sp_instance;
					break;
				}
			}
			widget_ce_schedule_content = sn_cd.cd_ContentDelivery.getContentForWidgetInstance(TOPIC_CONTENT_EXPERIENCE_SC, topicId);
		}

		if(new GlidePluginManager().isActive('com.sn_content_automation')){
			var gr2 = new GlideRecord('sn_ca_campaign_item');
			gr2.addQuery('topic','CONTAINS', topicId);
			gr2.query();
			while (gr2.next()) {
				if(gr2.sp_instance.sp_widget == CEW) {
					TOPIC_CONTENT_EXPERIENCE_CC = gr2.sp_instance;
					break;
				}
			}
			if(new GlidePluginManager().isActive('com.sn_content_delivery'))
				widget_ce_campaign_content = sn_cd.cd_ContentDelivery.getContentForWidgetInstance(TOPIC_CONTENT_EXPERIENCE_CC, topicId);
		}

		if (widget_ce_schedule_content.length === 0 && widget_ce_campaign_content.length===0) {
			if(options.select_topics && options.select_topics.includes(topicId)) {
				fetchIconOrBannerForSelectedTopics();
			} else {
				fetchIconOrBannerForAllTopics();
			}
		}
		else {
			if(options.select_topics && options.select_topics.includes(topicId)) {
				if(options.secondary_display === ICON){
					setIconDisplay();
					return;
				}
			}
			else{
				if(options.primary_display === ICON){
					setIconDisplay();
					return;
				}
			}
			setTextOnlyDisplay();
		}
	}

	function fetchIconOrBannerForSelectedTopics() {
		if (options.secondary_display === BANNER) {
			var banner = fetchTopicBanner();
			data.topic.banner = banner;
			data.displayMode = BANNER;
		} else if (options.secondary_display === ICON) {
			setIconDisplay();
		}
	}

	function fetchIconOrBannerForAllTopics() {
		if (options.primary_display === BANNER) {
			var banner = fetchTopicBanner();
			data.topic.banner = banner;
			data.displayMode = BANNER;
		} else if (options.primary_display === ICON) {
			setIconDisplay();
		}
	}

	function setIconDisplay() {
		var icon = fetchTopicIcon();
		if(icon && icon.trim().length > 0) {
			data.topic.icon = icon;
			data.displayMode = ICON;
		}
		else {
			setTextOnlyDisplay(); //fallback
		}
	}
	
	function setTextOnlyDisplay() {
		data.displayMode = TEXT_ONLY;
	}

	function fetchTopicBanner() {
		return sn_taxonomy.Topic.getBannerImage(topicId);
	}

	function fetchTopicIcon() {
		var icon = sn_taxonomy.Topic.getIcon(topicId);
		if(icon.trim().length === 0) {
			icon = new sn_ex_sp.TopicPageUtil().fetchDefaultIconImage();
		}
		return icon;
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>alice</sys_created_by>
        <sys_created_on>2023-08-24 11:43:21</sys_created_on>
        <sys_id>58ee54a247b0f5107ec50d45d36d43a6</sys_id>
        <sys_mod_count>2</sys_mod_count>
        <sys_name>VV_Topic_Header</sys_name>
        <sys_package display_value="VroomVroom" source="x_1112736_vroomvro">7ee51c1a4730b5107ec50d45d36d4385</sys_package>
        <sys_policy/>
        <sys_scope display_value="VroomVroom">7ee51c1a4730b5107ec50d45d36d4385</sys_scope>
        <sys_update_name>sp_widget_58ee54a247b0f5107ec50d45d36d43a6</sys_update_name>
        <sys_updated_by>alice</sys_updated_by>
        <sys_updated_on>2023-08-24 11:48:22</sys_updated_on>
        <template><![CDATA[<div class="topic-container"
     ng-class="{'mobile-border': c.data.isMobileApp }">

  <div ng-class="data.isMobileApp ? 'topic-header-mobile':'topic-header'"
       ng-if="data.displayMode === 'text_only' || data.displayMode === 'icon'">
    <div class="topic-header-icon__image-div"
         ng-if="data.displayMode === 'icon'"
         ng-class="c.getIconColorClass()"
         ng-style="c.getIconBackgroundColor()">
      <img ng-src="{{data.topic.icon}}?t=small"
           ng-if="data.topic.icon"
           aria-hidden="true" />
    </div>

    <div class="topic-header-icon__text">
      <h1 class="topic-header-title">{{::data.topic.name}}</h1>
      <h5 class="topic-header-description"
          ng-if="::(options.include_description == 'true')">{{::data.topic.desc}}</h5>
    </div>
  </div>
 
  <div ng-if="options.short_description" class="text-center h4 m-b-lg sp-tagline-color" ng-bind="options.short_description"></div>

  <div ng-class="c.getTopicHeaderWithBannerClass()"
       ng-if="data.displayMode === 'banner'">
    <div class="topic-header-banner__image"
         ng-class="c.getBannerColorClass()"
         ng-style="c.getBannerStyle()">
      <div class="topic-header-banner__gradient"
           ng-style="c.getTransparency()"/>
    </div>
    <div class="topic-header-banner__text col-xs-11 col-sm-6 col-md-4">
      <h1 class="topic-header-title">{{::data.topic.name}}</h1>
      <h5 class="topic-header-description"
          ng-if="::(options.include_description == 'true')">{{::data.topic.desc}}</h5>
    </div>
  </div>

</div>]]></template>
    </sp_widget>
</record_update>
